<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Account</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <div class="container">
    <h2>Welcome, {{ user.first_name }} {{ user.last_name }}</h2>
    <p>Email: {{ user.email }}</p>
    <p>Rewards Points: {{ user.rewards_points }}</p>

    {% if user.membership_number %}
      <p><strong>Membership #:</strong> {{ user.membership_number }}</p>
      <p>Joined: {{ user.join_date }}</p>
    {% else %}
      <form id="membership-form">
        <button type="submit" class="btn btn-primary">Join Membership</button>
      </form>
    {% endif %}

    <hr>
    <h3>Purchase History</h3>
    {% if purchases %}
      <ul>
        {% for p in purchases %}
          <li>{{ p.date }} — Receipt #{{ p.receipt_id }} — ${{ p.total_amount }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No purchases yet.</p>
    {% endif %}
  </div>

  <script>
    document.getElementById("membership-form")?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const res = await fetch("/join-membership", { method: "POST" });
      const data = await res.json();
      if (data.success) location.reload();
      else alert(data.error || "Error joining membership");
    });
  </script>
</body>
</html>
